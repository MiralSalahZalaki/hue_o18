<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="ad_periodic_assessment_template">
        <t t-call="web.html_container">
            <head>
                <meta charset="UTF-8"/>
                <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
                <link rel="preconnect" href="https://fonts.googleapis.com"/>
                <link rel="preconnect" href="https://fonts.gstatic.com" />
                <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&amp;display=swap" rel="stylesheet"/>
                <style>
                    body {
                        font-size:12px !important;
                    }
                    .container {
                        max-width: 100% !important;
                        width: 100% !important;
                    }

                    /* لضمان وجود Scroll */
                    .table-container {
                        overflow-x: auto;
                        -webkit-overflow-scrolling: touch;
                        margin-top: 10px;
                    }
                    .table-container table {
                        min-width: 1000px; 
                        white-space: nowrap;
                    }

                    table {
                        border: 1px solid #000 !important;
                        background-color: #f9f9f9 !important;
                        width: 100% !important;
                        text-align: center !important;
                        border-collapse: collapse !important;
                    }
                    td {
                        white-space: nowrap !important;
                    }
                    td, th {
                        border: 1px solid #000 !important;
                        text-transform: capitalize !important;
                    }
                    table tr:nth-child(even) {
                        background: #D0E4F5 !important;
                    }
                    table thead {
                        border-bottom: 2px solid #000 !important;
                    }
                    table thead th {
                        font-size: 13px !important;
                        font-weight: 600 !important;
                        color: #3B4345 !important;
                        text-align: center !important;
                        vertical-align: inherit !important;
                    }
                    table tfoot td {
                        font-size: 14px !important;
                    }
                    table tfoot .links {
                        text-align: right !important;
                    }
                    table tfoot .links a {
                        display: inline-block !important;
                        background: #1C6EA4 !important;
                        color: #FFFFFF !important;
                        padding: 2px 8px !important;
                        border-radius: 5px !important;
                    }
                    .table &gt; thead &gt; tr &gt; th, .table &gt; tbody &gt; tr &gt; th, .table &gt; tfoot &gt; tr &gt; th,
                    .table &gt; thead &gt; tr &gt; td, .table &gt; tbody &gt; tr &gt; td, .table &gt; tfoot &gt; tr &gt; td {
                        padding: 0px !important;
                        line-height: 1.42857143 !important;
                        vertical-align: middle !important;
                        border-top: 1px solid #dddddd !important;
                    }
                    .assessment-times-header {
                        text-align: right;
                        margin-bottom: 10px;
                        font-weight: bold;
                    }
                    .page-break {
    page-break-after: always;
}
                    @media print {
    .btn-print {
        display: none !important;
    }
    .table-container {
        overflow: visible !important;
        -webkit-overflow-scrolling: auto !important;
    }
    .table-container table {
        min-width: auto !important;
        white-space: normal !important;
    }
    table {
        page-break-inside: auto;
        font-size: 10px !important;
    }
    .page {
        page-break-before: always;
    }
    .page:first-child {
        page-break-before: avoid;
    }
    .page-break {
        display: none;
    }
}
                </style>
            </head>
            <button onclick="javascript:window.print()" class="btn-print">Print</button>
            <!-- Loop through each student -->
            <t t-foreach="students_data" t-as="student">
                <div class="page">
                    <!-- Report Header -->
                    <div class="row">
                        <div class="col-xs-12" style="text-align: center;">
                            <h1>Periodic Assessment Report</h1>
                        </div>
                    </div>
                    <!-- Assessment Times Header -->
                    <div class="assessment-times-header">
                        <t t-set="assessment_times_names" t-value="', '.join([time_data['assessment_time'] for time_data in student.get('assessment_times_data', [])])"/>
                        Assessments Adding Time:
                        <span t-esc="assessment_times_names"/>
                    </div>
                    <!-- Student Information -->
                    <div class="student-info">
                        <div class="row">
                            <div class="col-xs-4">
                                <strong>Student Name:</strong>
                                <span t-esc="student.get('name', '')"/>
                            </div>
                            <div class="col-xs-4">
                                <strong>Grade:</strong>
                                <span t-esc="student.get('grade_name', '')"/>
                            </div>
                            <div class="col-xs-4">
                                <strong>Class:</strong>
                                <span t-esc="student.get('class_id', '')"/>
                            </div>
                        </div>
                    </div>
                    <hr/>
                    <!-- Main Assessment Table with Scroller -->
                    <div class="table-container">
                        <div class="row">
                            <div class="col-xs-12">
                                <table class="table">
                                    <thead>
                                        <!-- First Header Row - Assessment Names -->
                                        <tr>
                                            <th rowspan="2" class="subject-col">Subject</th>
                                            <th rowspan="2" class="adding-times-col">Adding Times</th>
                                            <!-- Get assessments from first subject -->
                                            <t t-set="first_subject" t-value="syllabus_data[0] if syllabus_data else {}"/>
                                            <t t-if="first_subject.get('assessments', [])">
                                                <t t-foreach="first_subject['assessments']" t-as="assessment">
                                                    <!-- Skip assessment if hidden_student_report is True and student_view is True -->
                                                    <t t-if="not (assessment.get('hidden_student_report', False) and student_view)">
                                                        <th class="assessment-col">
                                                            <span t-esc="assessment['name']"/>
                                                        </th>
                                                    </t>
                                                </t>
                                            </t>
                                        </tr>
                                        <!-- Second Header Row - Max Scores -->
                                        <tr>
                                            <t t-if="first_subject.get('assessments', [])">
                                                <t t-foreach="first_subject['assessments']" t-as="assessment">
                                                    <!-- Skip assessment if hidden_student_report is True and student_view is True -->
                                                    <t t-if="not (assessment.get('hidden_student_report', False) and student_view)">
                                                        <th class="assessment-col">
                                                            <span t-esc="assessment['max_score']"/>
                                                        </th>
                                                    </t>
                                                </t>
                                            </t>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Loop through subjects -->
                                        <t t-foreach="syllabus_data" t-as="syllabus">
                                            <!-- Skip elective subjects not registered by student -->
                                            <t t-if="not syllabus['is_elective'] or syllabus['syllabus_id'] in student.get('registered_subjects', [])">
                                                <!-- Loop through each assessment time for this subject -->
                                                <t t-foreach="student.get('assessment_times_data', [])" t-as="time_data">
                                                    <tr>
                                                        <!-- Subject Name (only for first row of each subject) -->
                                                        <t t-if="time_data_index == 0">
                                                            <td t-att-rowspan="len(student.get('assessment_times_data', []))" class="subject-col">
                                                                <span t-esc="syllabus['syllabus_name']"/>
                                                            </td>
                                                        </t>
                                                        <!-- Assessment Time Name -->
                                                        <td class="adding-times-col">
                                                            <span t-esc="time_data['assessment_time']"/>
                                                        </td>
                                                        <!-- Assessment Scores -->
                                                        <t t-set="subject_result" t-value="time_data['subjects_results'].get(syllabus['syllabus_id'], {})"/>
                                                        <t t-foreach="syllabus.get('assessments', [])" t-as="assessment">
                                                            <!-- Skip assessment if hidden_student_report is True and student_view is True -->
                                                            <t t-if="not (assessment.get('hidden_student_report', False) and student_view)">
                                                                <t t-set="assessment_score" t-value="subject_result.get('assessments', {}).get(assessment['id'], {})"/>
                                                                <td class="assessment-col">
                                                                    <span t-esc="assessment_score.get('score', 0)"/>
                                                                </td>
                                                            </t>
                                                        </t>
                                                    </tr>
                                                </t>
                                            </t>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Absence Days Table with Scroller -->
                    <div class="table-container" style="margin-top: 20px;">
                        <div class="row">
                            <div class="col-xs-12">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th style="width: 50%;">Adding Times</th>
                                            <th style="width: 50%;">No of Absence Days</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="student.get('assessment_times_data', [])" t-as="time_data">
                                            <tr>
                                                <td>
                                                    <span t-esc="time_data['assessment_time']"/>
                                                </td>
                                                <td>
                                                    <strong>
                                                        <span t-esc="time_data['absence_days']"/>
                                                    </strong>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Page break after each student (except last one) -->
                <div t-if="student_index  &lt;  len(students_data) - 1" class="page-break"/>
            </t>
        </t>
    </template>
</odoo>